<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>画像検索結果 - 管理者</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">

  <!-- 戻るボタン（ページ先頭） -->
  <div class="mb-3">
    <a href="/admin/dashboard" class="btn btn-secondary">← ダッシュボードに戻る</a>
  </div>

  <h2 class="mb-4">MongoDB 登録画像一覧</h2>

  <!-- 検索フォーム -->
  <form method="get" action="/admin/search" class="mb-4">
    <div class="row g-2 align-items-end">
      <div class="col-sm-4">
        <label for="group_id" class="form-label">Group ID</label>
        <input type="text" id="group_id" name="group_id" value="{{ group_id }}" class="form-control">
      </div>
      <div class="col-sm-4">
        <label for="date" class="form-label">登録日（例: 2025-06-22）</label>
        <input type="date" id="date" name="date" value="{{ date }}" class="form-control">
      </div>
      <div class="col-sm-4">
        <label class="form-label">アップロード状態</label><br>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="db_uploaded" id="db_uploaded_true" value="true" {% if db_uploaded == 'true' %}checked{% endif %}>
          <label class="form-check-label" for="db_uploaded_true">アップロード済</label>
        </div>
        <div class="form-check form-check-inline">
          <input class="form-check-input" type="radio" name="db_uploaded" id="db_uploaded_false" value="false" {% if db_uploaded == 'false' %}checked{% endif %}>
          <label class="form-check-label" for="db_uploaded_false">未アップロード</label>
        </div>
      </div>
      <div class="col-sm-4">
        <button type="submit" class="btn btn-primary">検索</button>
      </div>
    </div>
  </form>

  {% if results %}
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
      {% for item in results %}
        <div class="col">
          <a href="/admin/detail/{{ item._id }}?group_id={{ group_id }}&date={{ date }}" class="text-decoration-none text-dark">
            <div class="card h-100">
              <div class="card-body">
                <p class="card-text">
                  <strong>登録年月日:</strong> {{ item.created_at or "未設定" }}<br>
                  <strong>group_id:</strong> {{ item.group_id or "未設定" }}<br>
                  <strong>user_short_id:</strong> {{ item.user_short_id or "未設定" }}<br>
                  <strong>画像枚数:</strong> {{ item.images | length if item.images else 0 }}
                </p>
              </div>
              {% if item.thumbnail_base64 %}
                <img src="data:image/jpeg;base64,{{ item.thumbnail_base64 }}" class="card-img-bottom" alt="Thumbnail">
              {% else %}
                <div class="card-img-bottom bg-secondary text-white text-center py-5">No Image</div>
              {% endif %}
            </div>
          </a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <div class="alert alert-warning mt-4">登録済み画像が見つかりませんでした。</div>
  {% endif %}

  <!-- 戻るボタン（ページ末尾） -->
  <div class="mt-4">
    <a href="/admin/dashboard" class="btn btn-secondary">← ダッシュボードに戻る</a>
  </div>

  {% if request.query_params.get('deleted') %}
    <script>
      alert("削除しました");
    </script>
  {% endif %}

</body>
</html>
