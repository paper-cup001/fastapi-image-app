<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ç®¡ç†è€…ç”¨ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="container py-4">
    <header class="pb-3 mb-4 border-bottom">
        <div class="d-flex align-items-center justify-content-between">
            <a href="/admin/dashboard" class="text-dark text-decoration-none">
                <span class="fs-4">ç®¡ç†è€…ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</span>
            </a>
            <div id="user-info">
                <!-- ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ -->
            </div>
        </div>
    </header>

    <div class="text-center">
        <h1 class="mb-4">ğŸ‘¤ æ“ä½œã‚’é¸æŠã—ã¦ãã ã•ã„</h1>
        <div class="d-grid gap-3 col-12 col-lg-6 mx-auto">
            <a href="/admin/manage-photographers" class="btn btn-outline-success">æ’®å½±è€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆç®¡ç†</a>
            <a href="/admin/generate_qr" class="btn btn-outline-primary">QRã‚³ãƒ¼ãƒ‰ç”Ÿæˆ</a>
            <a href="/admin/search" class="btn btn-outline-secondary">MongoDB ç™»éŒ²ç”»åƒä¸€è¦§</a>
            <a href="/admin/statistics" class="btn btn-outline-info">ã‚°ãƒ«ãƒ¼ãƒ—IDæ¯ã®çµ±è¨ˆæƒ…å ±</a>
            <a href="/admin/force_reset" class="btn btn-outline-danger">ä»®ç™»éŒ²ãƒªã‚¹ãƒˆã®åˆæœŸåŒ–</a>
        </div>
    </div>

    <footer class="mt-5 text-muted small text-center">
        &copy; 2024 Retro Game Image Upload
    </footer>

    <script>
        // ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã™ã‚‹é–¢æ•°
        async function fetchCurrentUser() {
            try {
                // ã“ã®ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã¯ã€ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’è¿”ã™ã‚ˆã†ã«åˆ¥é€”å®Ÿè£…ãŒå¿…è¦ã§ã™
                const response = await fetch('/admin/users/me');
                if (response.ok) {
                    const user = await response.json();
                    document.getElementById('user-info').innerHTML = `
                        <span class="me-3">ãƒ­ã‚°ã‚¤ãƒ³ä¸­: <strong>${user.email}</strong> (${user.role})</span>
                        <button class="btn btn-sm btn-outline-secondary" onclick="logout()">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</button>
                    `;
                } else {
                     // ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå–å¾—ã§ããªã„å ´åˆï¼ˆæœªãƒ­ã‚°ã‚¤ãƒ³ãªã©ï¼‰ã¯ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸
                    window.location.href = '/login.html';
                }
            } catch (error) {
                console.error('ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ:', error);
                window.location.href = '/login.html';
            }
        }

        // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†
        async function logout() {
            try {
                const response = await fetch('/logout', {
                    method: 'POST',
                });
                if (response.ok) {
                    alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã—ã¾ã—ãŸã€‚');
                    window.location.href = '/login';
                } else {
                    alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
                }
            } catch (error) {
                console.error('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ:', error);
                alert('ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚');
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
        document.addEventListener('DOMContentLoaded', fetchCurrentUser);
    </script>
</body>
</html>
