# 商品撮影用ウェブアプリ

## 1. 概要

このウェブアプリは、複数人・複数グループでの商品撮影と画像管理を効率化するためのツールです。特に、ゲームカセットや書籍など、定型的な商品の大量撮影を想定して設計されています。

### 3つの役割
本システムは、以下の3つの役割（ロール）によって構成されます。

1.  **システム管理者 (System Administrator):**
    最上位の管理者。運営者アカウントの発行や、運営者削除によって発生した「孤立データ」のメンテナンスなど、システム全体の管理を担当します。

2.  **運営者 (Operator):**
    日々の運用を担当する管理者（店舗の店長など）。撮影者のアカウントを発行したり、撮影用のQRコードを生成したり、自身に紐づく画像データを確認・管理します。

3.  **撮影者 (Photographer):**
    運営者によってアカウントが発行される、撮影担当者。スマートフォン等でQRコードを読み取り、撮影とアップロードに集中します。

### データ分離の原則
本システムは複数運営者の利用を前提としており、各運営者が管理するデータ（撮影者アカウント、画像グループ、画像データ）は、他の運営者からは完全に分離され、互いに閲覧・操作することはできません。

### 自動トリミング機能
オプションの撮影用治具と組み合わせて使用することで、撮影された画像から商品を自動でトリミングする機能を備えています。

### APIアクセス
本アプリケーションが提供する各種機能は、Web UIからだけでなく、外部アプリケーションから直接呼び出せるAPIも提供しています。APIアクセスにはBearerトークン認証を採用しており、安全な連携が可能です。詳細は `documents/api仕様書.txt` をご確認ください。

---

## 2. セットアップ手順

### 2.1 前提条件
- MongoDB（バージョン4.4以上推奨）
- Python 3.9 以上（Python 3.11 にて開発・確認済）
- `uvicorn`

### 2.2 環境構築
`documents/environment.yml` を用いたConda環境の利用を推奨します。

1.  **リポジトリをクローンします。**
    ```bash
    git clone <リポジトリURL>
    cd <リポジトリ名>
    ```

2.  **MongoDBの接続設定**
    環境変数 `MONGO_URL` に、使用するMongoDBの接続文字列を設定してください。
    ```bash
    export MONGO_URL="mongodb://localhost:27017"
    ```

3.  **Conda環境を構築・有効化します。**
    ```bash
    conda env create -f documents/environment.yml
    conda activate fastapi_env
    ```

4.  **(任意) PipとVenvを利用する場合**
    Condaを利用しない場合は、`venv`と`pip`で環境を構築することも可能です。詳細は `documents/readme.md` の旧版をご参照ください。

### 2.3 アプリケーションの起動
```bash
uvicorn main:app --reload --host 0.0.0.0 --port 8000
```

---

## 3. 使い方（初回起動とワークフロー）

### 3.1 初回起動と管理者作成

アプリケーションを初めて起動した直後は、ユーザーが一人も登録されていません。まず、コマンドラインから**システム管理者**と、最初の**運営者**を作成する必要があります。

1.  **システム管理者を作成します。**
    ターミナルで以下のコマンドを実行し、指示に従ってメールアドレスとパスワードを入力してください。
    ```bash
    python create_system_admin.py
    ```

2.  **最初の運営者を作成します。**
    同様に、最初の運営者アカウントを作成します。
    ```bash
    python create_operator.py
    ```

### 3.2 主なワークフロー

1.  **システム管理者**がログインし、二人目以降の**運営者**アカウントを作成します。
2.  **運営者**がログインし、担当の**撮影者**アカウントを作成します。
3.  **運営者**が「撮影用URL/QRコード作成」機能で、`group_id`（買取IDなど）を指定したQRコードを生成します。
4.  **撮影者**がスマートフォンでログインし、QRコードを読み取って撮影・アップロード作業を行います。
5.  **運営者**は、自身の管理画面で、アップロードされた画像を確認・管理したり、統計情報を閲覧したりします。
6.  運営者が退職などで削除された場合、**システム管理者**は「孤立データ管理」機能を使って、残されたデータを整理します。

---

## 4. 主な機能

- **システム管理者**
    - 運営者アカウントのCRUD（作成・一覧・削除）
    - 孤立データ（撮影者、画像グループ）の保守管理（所有者の再割り当て、ダウンロード、削除）

- **運営者**
    - 自身に紐づく撮影者アカウントのCRUD
    - 撮影用QRコードとURLの生成
    - 自身に紐づく画像データの階層的閲覧、詳細確認、削除
    - 自身に紐づくデータの統計情報閲覧

- **撮影者**
    - QRコードスキャンによる撮影セッション開始
    - 画像の撮影とアップロード

詳細は `documents/取扱説明書_管理者用.md` をご参照ください。