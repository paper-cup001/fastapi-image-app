# フェーズ1 動作確認マニュアル

このマニュアルは、実装した`運営者`の認証システムの動作を確認するための手順を説明します。

---

## ステップ1: 準備

まず、アプリケーションを起動するための準備をします。

1.  **ターミナルを開き、プロジェクトディレクトリに移動します。**
    ```bash
    cd /path/to/your/project/FastAPI_mongoDB_10
    ```

2.  **仮想環境を有効化します。**
    ```bash
    source venv/bin/activate
    ```
    *(ターミナルの行頭に `(venv)` と表示されます)*

3.  **データベース接続情報を環境変数に設定します。**
    *MongoDBがローカルPCで動いている場合*
    ```bash
    export MONGO_URL='mongodb://localhost:27017/'
    ```
    *(この設定はターミナルを閉じるまで有効です)*

---

## ステップ2: `運営者`アカウントの作成

次に、ログインするための`運営者`アカウントを1つ作成します。

1.  **以下のコマンドを実行します。**
    *`<email>` と `<password>` の部分は、ご自身で決めたメールアドレスとパスワードに置き換えてください。*
    ```bash
    python create_operator.py operator@example.com MySecretPass123
    ```

2.  **「運営者アカウント ... を作成しました。」** というメッセージが表示されれば成功です。

---

## ステップ3: アプリケーションの起動

準備ができたので、Webサーバーを起動します。

1.  **以下のコマンドを実行します。**
    ```bash
    uvicorn main:app --reload --host 0.0.0.0 --port 8000
    ```

2.  `Application startup complete.` というメッセージが表示されたら、サーバーは待機状態です。

---

## ステップ4: 動作確認

ブラウザを使って、認証システムが正しく機能しているかを確認します。

### 4.1. 保護機能の確認（ログイン前）

1.  Webブラウザを開き、管理者向けページに直接アクセスしてみます。
    *   **URL:** `http://localhost:8000/admin/search`

2.  **期待される動作:**
    *   `/admin/search` の画面は表示されず、自動的に**ログインページ (`/login`) に転送（リダイレクト）**されれば成功です。
    *   これは、ログインしていないユーザーを「関所」が正しくブロックしていることを意味します。

### 4.2. ログイン機能の確認

1.  表示されたログインページで、**ステップ2で作成した`運営者`のメールアドレスとパスワード**を入力し、「ログイン」ボタンを押します。

2.  **期待される動作:**
    *   ログインに成功し、`/admin/search` の画面が正しく表示されれば成功です。

### 4.3. 保護機能の確認（ログイン後）

1.  ログインした状態で、他の管理者向けページにアクセスしてみます。
    *   例: `http://localhost:8000/admin/dashboard`
    *   例: `http://localhost:8000/admin/statistics`

2.  **期待される動作:**
    *   ログインページに飛ばされることなく、各ページが正常に表示されれば成功です。
    *   これは、一度「通行証（トークン）」を受け取った正規ユーザーは、自由に行き来できることを意味します。

---

## 補足: ログアウトについて

現在、明確な「ログアウト」ボタンは実装されていません。ログイン状態は、ブラウザのCookieに保存されたアクセストークンによって維持されています。

ログアウトをテストしたい場合は、お使いのブラウザの開発者ツールなどを開いて、`localhost`または`127.0.0.1`に紐づいているCookieを削除してください。Cookieを削除すると、再度管理者向けページにアクセスした際にログインページへ転送されるようになります。
